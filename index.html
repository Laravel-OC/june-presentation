<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Learning Laravel</title>
        <meta name="description" content="learning Laravel on the internet">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- deck.js has a lot of dependencies -->
        <link rel="stylesheet" media="screen" href="css/dist.css">
    </head>
    <body>

        <div class="deck-container">

                            <article class="slide"><h1>Why we use Laravel</h1></article>
            <article class="slide"><h1>Or, why we never want to write another database access class</h1></article>
            <article class="slide"><h1>Who are we?</h1></article>
            <article class="slide"><h2>Benjamin Walters</h2>
<ul>
<li>Developer</li>
<li>TODO</li>
<li>TODO</li>
</ul></article>
            <article class="slide"><h2>Ciaran Downey</h2>
<ul>
<li>PHP developer for over 3 years</li>
<li>Open source advocate</li>
<li>Likes the sound of his own voice</li>
</ul></article>
            <article class="slide"><h2>Justin Page</h2>
<ul>
<li>PHP Developer for over 2 years -respect the Double Claw</li>
<li>Obsessed with Mechanical Keyboards</li>
<li>KLVTZ: Kangaroo League on a Vendetta for Terrifying Zebras?</li>
</ul></article>
            <article class="slide"><h2>Today we're going to talk about...</h2>
<ul>
<li>How to do some common tasks in Laravel</li>
<li>How to do those tasks without Laravel</li>
<li>Pitfalls for either approach</li>
</ul></article>
            <article class="slide"><h1>Let's get started</h1></article>
            <article class="slide"><h2>Retrieving records from a database</h2></article>
            <article class="slide"><h2>The Laravel way</h2>
<pre><code class="language-php">class User extends Eloquent
{
    // don't need to add anything here
}</code></pre></article>
            <article class="slide"><h2>The Laravel way (cont'd)</h2>
<pre><code class="language-php">// grabbing all the users:
$all_users = User::all();

// grabbing the user with pk = 3
$user_no_3 = User::find(3);</code></pre></article>
            <article class="slide"><h2>The Laravel way (cont'd)</h2>
<pre><code class="language-php">// grabbing the first 10 teenage users
// organized by age (old -&gt; young)
$teenagers = User::whereBetween("age", [13, 19])
    -&gt;orderBy("age", "desc")
    -&gt;take(10)
    -&gt;get();</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way</h2>
<pre><code class="language-php">class BaseRepo
{
    private $conn;

    public function __construct(PDO $conn) {
        $this-&gt;conn = $conn;
    }

    // continued</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way</h2>
<pre><code class="language-php">    public function fetchByQuery($query)
    {
        $stmt = $this-&gt;conn-&gt;prepare($query);

        $stmt-&gt;execute();

        return $stmt-&gt;fetch();
    }
}</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">class UserRepo extends BaseRepo {

    public function findByPk($key) {
        $safe_key = intval($key);

        return $this-&gt;fetchByQuery(
            "SELECT * FROM users
              WHERE id = {$safe_key}"
        );
    }</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">    // continued
    public function findAll()
    {
        return $this-&gt;fetchByQuery(
            "SELECT * FROM users"
        );
    }
}</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">$repo = new UserRepo($db_from_somewhere);

// grab all the users
$all_users = $repo-&gt;findAll();

// grabbing the user with pk = 3
$user_no_3 = $repo-&gt;findByPk(3);</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">// grabbing the first 10 teenage users
// organized by age (old -&gt; young)
$teenagers = $repo-&gt;fetchByQuery(
    "SELECT * FROM users
        WHERE age BETWEEN 13 AND 19
        ORDER BY age DESC LIMIT 10"
);</code></pre></article>
            <article class="slide"><h2>Other benefits Laravel provides</h2>
<ul>
    <li class="slide">
        <h5>
            SQL injection protection
        </h5>
    </li>
    <li class="slide">
        <h5>
            Saved scopes (saved conditions that can be stacked)
        </h5>
    </li>
    <li class="slide">
        <h5>
            Chunking (load X records into memory at a time)
        </h5>
    </li>
    <li class="slide">
        <h5>
            Seamless interop between different DB engines
        </h5>
    </li>
    <li class="slide">
        <h5>Different data types</h5>
        <ul>
            <li><code>datetime</code>s as Date objects</li>
            <li><code>mutators</code> and <code>accessors</code></li>
        </ul>
    </li>
</ul>


</article>
            <article class="slide"><h2>Basic routing</h2></article>
            <article class="slide"><h2>The Laravel way</h2>
<pre><code class="language-php">Route::get('/blog', function() {
    // do blog stuff
});

// or

Route::get("/blog", "BlogController@showBlog");</code></pre></article>
            <article class="slide"><h2>The Laravel way (cont'd)</h2>
<pre><code class="language-php">// different request methods

Route::get("/blog/post/{id}", function ($id) {
    // show that post
});

Route::delete("/blog/post/{id}", function ($id) {
    // delete that post
});</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way</h2>
<pre><code class="language-bash">+-- about
   |   +-- index.php
   +-- blog
       +-- index.php
       +-- post
           +-- index.php</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way</h2>
<pre><code class="language-php">switch (strtoupper($_SERVER["REQUEST_METHOD")) {
    "GET":
        // show the post
        break;
    "DELETE":
        // do delete stuff
        break;
    default:
        // show a 404
}</code></pre></article>
            <article class="slide"><h2>Autoloading</h2></article>
            <article class="slide"><h2>The Laravel way</h2>
<p>Use composer</p></article>
            <article class="slide"><h2>The Composer way</h2>
<pre><code class="language-javascript">{
    "require": {
        "laravel/framework": "~4.2.3"
    },
    "autoload": {
        "psr-4": {"MyNamespace\\": "src/"}
    },
    "config": { "preferred-install": "dist" },
    "minimum-stability": "stable"
}</code></pre></article>
            <article class="slide"><h2>The Composer way (cont'd)</h2>
<pre><code class="language-php">&lt;?php // entry file

require __DIR__ . "/vendor/autoload.php";</code></pre></article>
            <article class="slide"><h2>The Composer way (cont'd)</h2>
<pre><code class="language-php">// as long as the autoload file has been included
// before, we don't have to specify anything else

$cat = new MyNamespace\Model\Cat();

$hat = new MyNamespace\Fashion\Hat();

$cat-&gt;moveInside($hat);</code></pre></article>
            <article class="slide"><h2>The Old way</h2>
<pre><code class="language-php">// ever seen something like this?
require "../inc/libs/_globals/bootstrap_NEW.php";

// or this?
foreach ($required_files as $file) {
    require $file;
}

// or this?
foreach (glob("../lib/*.php") as $file) {
    require $file;
}</code></pre></article>
            <article class="slide"><h1>PUBLIC SERVICE ANNOUNCEMENT</h1></article>
            <article class="slide"><h1>USE COMPOSER</h1></article>
            <article class="slide"><h2>CSRF tokens</h2></article>
            <article class="slide"><blockquote>
<p>CSRF is an attack which forces an end user to execute unwanted actions on a web
application in which he/she is currently authenticated</p>
<p>&mdash; <a href="https://www.owasp.org/index.php/CSRF">owasp.org</a></p>
</blockquote></article>
            <article class="slide"><h1>Does everyone know what CSRF is?</h1></article>
            <article class="slide"><h1>And you're all protecting yourselves correctly, right?</h1></article>
            <article class="slide"><h2>The Laravel way</h2>
<pre><code class="language-php">&lt;input type="hidden"
    name="_token"
    value="&lt;?php echo csrf_token(); ?&gt;"&gt;</code></pre></article>
            <article class="slide"><h2>The Laravel way (cont'd)</h2>
<pre><code class="language-php">Route::post('register', [
    // filters to apply
    'before' =&gt; 'csrf',
    function() {
        return 'You gave a valid CSRF token!';
    }
]);

// Or
Route::post('register',
    ["before" =&gt; "csrf", "Controller@register"]
);</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way</h2>
<pre><code class="language-php">// generates the csrf token
function csrf_token()
{
    if (session_status() !== PHP_SESSION_ACTIVE) {
        session_start();
    }

    $_SESSION["token"] =
        md5(uniqid(mt_rand(), true)));

    return ($_SESSION["_token"]);
}</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">&lt;input type="hidden"
    name="_token"
    value="&lt;?php echo csrf_token(); ?&gt;"&gt;</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">function check_token()
{
    if (session_status() !== PHP_SESSION_ACTIVE) {
        session_start();
    }

    // works with both POST and GET
    $req = count($_POST) ? $_POST : $_GET;

    return isset($req["_token"])
        &amp;&amp; $req["_token"] !== $_SESSION["_token"];
}</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">// now just call that in every file you need it
if (check_token()) {
    show_error_page_or_whatever_we_do();
}</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">// except...

// remember this line?
$_SESSION["token"] =
    md5(uniqid(mt_rand(), true)));

// are you sure that's secure?</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">// Here's what Laravel does
$random = 'openssl_random_pseudo_bytes';
if (function_exists($random)) {
    $bytes  = $random($length * 2);
    $base64 = base64_encode($bytes);

    return substr(
        str_replace(['/', '+', '='], '', $base64),
        0,
        $length
    );
}</code></pre></article>
            <article class="slide"><h2>The vanilla PHP way (cont'd)</h2>
<pre><code class="language-php">// or if we don't have openssl_random_pseudo_bytes
} else {
    $pool = '0123456789'
        . 'abcdefghipqrstuvwxyz'
        . 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

    return substr(
        str_shuffle(str_repeat($pool, 5)),
        0,
        $length
    );
}</code></pre></article>
            <article class="slide"><h2>Questions for the audience</h2>
<ul>
<li>
<p>How many of you have written functions like this?</p>
</li>
<li>
<p>Who can tell us what these parameters mean?</p>
</li>
<li>How much do you trust your implementation?</li>
</ul></article>
            <article class="slide"><blockquote>
<p>Anyone, from the most clueless amateur to the best cryptographer, can create an
algorithm that he himself can't break.</p>
<p>&mdash; <cite><a href="https://www.schneier.com/blog/archives/2011/04/schneiers_law.html">Bruce Schneier</a></cite></p>
</blockquote></article>
    
            <p class="deck-status" aria-role="status">
                <span class="deck-status-current"></span>
                /
                <span class="deck-status-total"></span>
            </p>
        </div>

        <script src="js/dist.js"></script>
    </body>
</html>
